<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agregar Video - Goikorol</title>
    <link rel="icon" href="imagenes/logo.png" type="image/jpeg">
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <!-- Header simplificado (o copia el completo si querÃ©s) -->
    <header id="dynamic-header">
        <!-- ... pega tu nav ... -->
    </header>

    <main>
        <section id="add-video">
            <h2>Agregar Nuevo Video</h2>
            <form id="video-form">
                <label for="id">ID de YouTube (ej: dQw4w9WgXcQ):</label>
                <input type="text" id="id" required>

                <label for="title">TÃ­tulo:</label>
                <input type="text" id="title" required>

                <label for="description">DescripciÃ³n:</label>
                <textarea id="description" required></textarea>

                <label for="date">Fecha (YYYY-MM-DD):</label>
                <input type="date" id="date" required>

                <label for="tags">Tags (separados por coma):</label>
                <input type="text" id="tags" placeholder="mÃºsica,reacciÃ³n,spinetta">

                <!-- Thumbnail se genera auto con el ID -->
                <p>Thumbnail: Se genera automÃ¡ticamente desde YouTube.</p>

                <button type="submit">Agregar Video</button>
                <button type="button" id="clear-form">Limpiar</button>
                <button type="button" id="download-json">Descargar JSON Actualizado</button>
                <button type="button" id="copy-json">Copiar JSON al Portapapeles</button>
            </form>
            <p id="status"></p>
        </section>
        <h3>JSON generado</h3>
            <textarea id="json-preview" rows="15" readonly
                style="width:100%; font-family: monospace; resize: vertical;">
            </textarea>

    </main>

    <!-- Footer -->
    <footer class="site-footer">
        <!-- ... pega tu footer ... -->
    </footer>

    <script>
    let videos = JSON.parse(localStorage.getItem('videos')) || [];

    const form = document.getElementById('video-form');
    const jsonPreview = document.getElementById('json-preview');
    const status = document.getElementById('status');

    // Extraer ID desde URL o ID directo
    function extractYouTubeID(input) {
        const regex = /(?:v=|youtu\.be\/|embed\/)([^?&]+)/;
        const match = input.match(regex);
        return match ? match[1] : input.trim();
    }

    // Actualizar preview JSON
    function updatePreview() {
        jsonPreview.value = JSON.stringify(videos, null, 4);
        localStorage.setItem('videos', JSON.stringify(videos));
    }

    // Inicializar preview
    updatePreview();

    // Agregar video
    form.addEventListener('submit', (e) => {
        e.preventDefault();

        const rawInput = document.getElementById('id').value;
        const videoId = extractYouTubeID(rawInput);

        const newVideo = {
            id: videoId,
            title: document.getElementById('title').value,
            description: document.getElementById('description').value,
            date: document.getElementById('date').value,
            tags: document.getElementById('tags').value
                .split(',')
                .map(t => t.trim())
                .filter(Boolean),
            thumbnail: `https://img.youtube.com/vi/${videoId}/hqdefault.jpg`
        };

        // Evitar duplicados
        if (videos.some(v => v.id === videoId)) {
            status.textContent = 'âš ï¸ Este video ya estÃ¡ cargado.';
            return;
        }

        videos.push(newVideo);
        updatePreview();

        status.textContent = 'âœ… Video agregado correctamente.';
        form.reset();
    });

    // Limpiar TODO (form + videos + JSON)
document.getElementById('clear-form').addEventListener('click', () => {
    const confirmClear = confirm(
        'âš ï¸ Esto eliminarÃ¡ TODOS los videos cargados.\nÂ¿QuerÃ©s continuar?'
    );

    if (!confirmClear) return;

    videos = [];
    localStorage.removeItem('videos');
    form.reset();
    jsonPreview.value = '[]';
    status.textContent = 'ðŸ§¹ Todo fue limpiado correctamente.';
});


    // Descargar JSON
    document.getElementById('download-json').addEventListener('click', () => {
        const blob = new Blob(
            [JSON.stringify(videos, null, 4)],
            { type: 'application/json' }
        );
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'videos.json';
        a.click();
        URL.revokeObjectURL(url);
    });

    // Copiar JSON
    document.getElementById('copy-json').addEventListener('click', () => {
        navigator.clipboard.writeText(jsonPreview.value);
        status.textContent = 'ðŸ“‹ JSON copiado al portapapeles.';
    });
</script>

</body>
</html>